<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="com.iu.base.member.MemberDAO">
  	
  	<insert id="setMemberAdd" parameterType="MemberVO">
  		INSERT INTO MEMBER
  		VALUES (#{userName}, #{passWord}, #{name}, #{email}, #{birth}, 1)
  	</insert>
  	
  	<insert id="setMemberRoleAdd" parameterType="MemberVO">
  		INSERT INTO MEMBER_ROLE
  		VALUES (#{userName}, 3)
  	</insert>
  	
  	<select id="getMemberLogin" parameterType="MemberVO" resultMap="getMemberLoginResult">
  		SELECT *
			FROM 
			MEMBER
			INNER JOIN
			MEMBER_ROLE 
			USING(USERNAME)
			INNER JOIN 
			ROLE
			USING(NUM)
		WHERE USERNAME = #{userName} AND PASSWORD = #{passWord}
  	</select>
  	
  	<resultMap type="MemberVO" id="getMemberLoginResult">
  		<id column="USERNAME" property="userName"/>
  		<result column="PASSWORD" property="passWord"/>
  		<result column="NAME" property="name"/>
  		<result column="EMAIL" property="email"/>
  		<result column="BIRTH" property="birth"/>
  		<result column="ENABLED" property="enabled"/>  
  		
  		<collection property="roleVOs" javaType="List" ofType="RoleVO">
  			<id column="NUM" property="num"/>
  			<result column="ROLENAME" property="roleName"/>
  		</collection>
  	</resultMap>
  	
  	<select id="idDuplicateCheck" resultType="MemberVO" parameterType="MemberVO">
  		SELECT USERNAME FROM MEMBER WHERE USERNAME = #{userName}
  	</select>
  	
  </mapper>